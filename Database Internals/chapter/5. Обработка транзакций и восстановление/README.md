> Транзакция – это неделимая логическая единица работы в СУБД позволяющая
> представить несколько операций в виде единого шага

### Свойства транзакций

* **_Атомарность_**
  Стадии транзакции неотделимы друг от друга т, е, либо все стадии связанные
  с транзакцией выполняются успешно либо не выполняется ни одна из них,
  Иными словами транзакции не должны выполняться частично, Каждая тран«
  закция может быть либо зафиксирована ( в случае чего становятся
  видимыми все изменения вносимые операциями записи выполняемыми в рамках
  транзакции(либо прервана &в случае чего производится откат всех побочных
  эффектов транзакции которые еще не стали видимыми(, Фиксация –
  это заключительная операция, После прерывания может быть предпринята повторная
  попытка выполнения транзакции,
* **_Согласованность_**
  Согласованность – свойство зависящее от приложения: транзакция должна
  переводить базу данных из одного допустимого состояния в другое допустимое
  состояние сохраняя все инварианты базы данных &включая различные ограни«
  чения ссылочную целостность и т, д,(, Согласованность является наиболее слабо
  определенным свойством возможно потому что это единственное свойство
  которое контролируется пользователем а не только самой базой данных,
* **_Изолированность_**
  Несколько параллельно выполняемых транзакций должны выполняться без вза«
  имного влияния друг на друга как если бы в это время не выполнялись никакие
  другие транзакции. Изолированность определяет когда должны становиться видимыми изменения
  в состоянии базы данных и какие изменения должны быть видимыми для парал«
  лельных транзакций, Ради повышения производительности многие базы данных
  используют более слабые уровни изолированности по сравнению с данным опре«
  делением, В зависимости от методов и подходов используемых для управления
  параллелизмом изменения вносимые транзакцией могут быть видны или не
  видны другим параллельным транзакциям
* **_Долговечность_**
  После фиксации транзакции все изменения в состоянии базы данных должны
  персистентно храниться на диске и сохраняться в случае перебоев в электро«
  снабжении и сбоев и отказов системы

### Кеширование

СУБД используют двухуровневую архитектуру хранения: в ОЗУ и на персистентном хранилище.
Для уменьшения количества обращений к более медленным по сравнению с ОЗУ диска используется кеш страниц.
Данные могут **_подкачиваться_** и **_вытеснятся_** из кеша страниц.
Многие СУБД открывают файлы с флагом **O_DIRECT**, который позволяет обращаться к дискам напрямую минуя кеш ОС

В качестве реализаций кеша могут быть использованы:

- LRU
- 2Q
- LFU
- CLOCK

![img.png](../../resources/clock-cache.png)

### Восстановление

> Журнал упреждающей записи (WAL, write-ahead log) также иногда называемый
> журналом фиксации – это вспомогательная дисковая структура с доступом только
> для добавления которая используется для восстановления после сбоев и восстановления транзакций

Основные функции журнала упреждающей записи можно свести к следующему:

- Позволяет кэшу страниц буферизировать обновления размещенных на диске
  страниц с обеспечением долговечности в общем контексте СУБД,
- Производит персистентное сохранение всех операций на диске до тех пор пока
  кэшированные копии страниц затронутых этими операциями не будут синхронизированы с копиями на диске, Каждая операция
  которая изменяет состояние
  базы данных должна быть записана в журнале на диске до изменения содержимого
  соответствующих страниц,
- Позволяет в случае сбоя восстановить из журнала операций потерянные изменения которые были произведены в памяти

Для определения подходящего момента для выгрузки на диск произведенных
в памяти изменений СУБД используют политики кражи/без кражи и принуждения/без принуждения

Метод восстановления который позволяет выгрузить измененную транзакцией  
страницу еще до фиксации транзакции называется политикой **_кражи_**

Политика **_принуждения_** требует чтобы все измененные транзакциями страницы  
были выгружены на диск до фиксации транзакций

### Управление параллелизмом

> Управление параллелизмом – это набор методов обеспечивающих взаимодействие параллельно выполняемых транзакций, Эти методы  
можно разделить на следующие основные категории